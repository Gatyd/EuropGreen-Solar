{% extends 'emails/base.html' %}

{% block title %}√âch√©ance atteinte : T√¢che assign√©e - EuropGreen Solar{% endblock %}

{% block content %}
<div style="margin-bottom: 32px;">
    <h1 style="color: #1f2937; font-size: 24px; font-weight: 600; margin: 0 0 8px 0;">
        √âch√©ance atteinte
    </h1>
    <p style="color: #6b7280; font-size: 14px; margin: 0;">
        La t√¢che que vous avez assign√©e √† <strong>{{ task.assigned_to.first_name }} {{ task.assigned_to.last_name }}</strong> arrive √† √©ch√©ance
    </p>
</div>

<!-- Carte de la t√¢che -->
<div style="background-color: #f3f4f6; border-left: 4px solid #6366f1; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
    
    <!-- Titre et priorit√© -->
    <div style="margin-bottom: 16px;">
        <h2 style="color: #1f2937; font-size: 20px; font-weight: 600; margin: 0 0 8px 0;">
            {{ task.title }}
        </h2>
        <div style="text-align: left;">
            {% if task.priority == 'urgent' %}
            <span style="display: inline-block; background-color: #fee2e2; color: #991b1b; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                Urgente
            </span>
            {% elif task.priority == 'high' %}
            <span style="display: inline-block; background-color: #fef3c7; color: #92400e; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                Haute priorit√©
            </span>
            {% elif task.priority == 'normal' %}
            <span style="display: inline-block; background-color: #dbeafe; color: #1e40af; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                Normale
            </span>
            {% else %}
            <span style="display: inline-block; background-color: #e5e7eb; color: #374151; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                Basse
            </span>
            {% endif %}
        </div>
    </div>

    {% if task.description %}
    <!-- Description -->
    <div style="margin-bottom: 16px;">
        <p style="color: #374151; font-size: 14px; line-height: 1.6; margin: 0; white-space: pre-wrap;">{{ task.description }}</p>
    </div>
    {% endif %}

    <!-- Information sur l'assignation -->
    <div style="background-color: #ffffff; border-radius: 6px; padding: 16px; margin-bottom: 12px;">
        <div style="margin-bottom: 12px;">
            <span style="color: #6b7280; font-size: 13px; font-weight: 500;">Assign√©e √† :</span>
            <span style="color: #1f2937; font-size: 14px; font-weight: 600; margin-left: 8px;">
                {{ task.assigned_to.first_name }} {{ task.assigned_to.last_name }}
            </span>
            <span style="color: #6b7280; font-size: 13px; margin-left: 4px; word-break: break-word;">
                ({{ task.assigned_to.email }})
            </span>
        </div>
        <div>
            <span style="color: #6b7280; font-size: 13px; font-weight: 500;">√âch√©ance :</span>
            <span style="color: #1f2937; font-size: 14px; font-weight: 600; margin-left: 8px;">
                {{ task.due_date|date:"d/m/Y" }}
                {% if task.due_time %}
                √† {{ task.due_time|time:"H:i" }}
                {% endif %}
            </span>
        </div>
    </div>

    <!-- Statut de la t√¢che -->
    <div style="background-color: #fef3c7; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
        <span style="color: #92400e; font-size: 13px; font-weight: 500;">Statut actuel :</span>
        {% if task.status == 'completed' %}
        <span style="color: #059669; font-size: 14px; font-weight: 600; margin-left: 8px;">‚úÖ Termin√©e</span>
        {% elif task.status == 'in_progress' %}
        <span style="color: #2563eb; font-size: 14px; font-weight: 600; margin-left: 8px;">üîÑ En cours</span>
        {% elif task.status == 'cancelled' %}
        <span style="color: #6b7280; font-size: 14px; font-weight: 600; margin-left: 8px;">‚ùå Annul√©e</span>
        {% else %}
        <span style="color: #dc2626; font-size: 14px; font-weight: 600; margin-left: 8px;">‚è≥ En attente</span>
        {% endif %}
    </div>

    {% if task.related_installation %}
    <!-- Installation li√©e -->
    <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid #d1d5db;">
        <div style="margin-bottom: 8px;">
            <span style="color: #6b7280; font-size: 13px; font-weight: 500;">Installation li√©e</span>
        </div>
        <a href="{{ frontend_url }}/home/installations/{{ task.related_installation.id }}" class="button-link"
           style="display: inline-block; background-color: #10b981; color: #ffffff; text-decoration: none; padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 500;">
            Voir l'installation
        </a>
    </div>
    {% endif %}

</div>

<!-- Message pour le responsable -->
<div style="background-color: #eff6ff; border-radius: 8px; padding: 20px; margin-bottom: 24px;">
    <p style="color: #1e40af; font-size: 15px; line-height: 1.6; margin: 0 0 12px 0; font-weight: 600;">
        Suivi de la t√¢che
    </p>
    <p style="color: #4b5563; font-size: 14px; margin: 0; line-height: 1.6;">
        Cette notification est envoy√©e pour vous informer que l'√©ch√©ance de la t√¢che est atteinte. 
        {% if task.status != 'completed' %}
        <strong style="color: #dc2626;">La t√¢che n'est pas encore marqu√©e comme termin√©e.</strong> 
        Vous pouvez contacter {{ task.assigned_to.first_name }} pour faire un point sur l'avancement.
        {% else %}
        <strong style="color: #059669;">La t√¢che a √©t√© marqu√©e comme termin√©e.</strong> Excellent travail !
        {% endif %}
    </p>
</div>

<!-- Bouton d'action -->
<div style="text-align: center; margin: 32px 0;">
    <a href="{{ frontend_url }}/home/calendar" 
       style="display: inline-block; background-color: #6366f1; color: #ffffff; text-decoration: none; padding: 14px 36px; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4);">
        Voir le calendrier
    </a>
</div>

<!-- Informations suppl√©mentaires -->
<div style="background-color: #f9fafb; border-radius: 8px; padding: 16px; margin-top: 24px; border-left: 4px solid #6b7280;">
    <p style="color: #4b5563; font-size: 13px; line-height: 1.5; margin: 0;">
        <strong>Note :</strong> Cette notification est envoy√©e automatiquement aux cr√©ateurs de t√¢ches lorsque l'√©ch√©ance est atteinte. 
        Elle vous permet de suivre l'avancement des t√¢ches que vous avez assign√©es et de r√©agir si n√©cessaire.
    </p>
</div>

{% endblock %}

{% block footer_content %}
<div style="margin-bottom: 16px;">
    <p style="color: #1f2937; font-weight: 500; font-size: 14px; margin-bottom: 4px; margin-top: 0;">
        EuropGreen Solar
    </p>
    <p style="color: #6b7280; font-size: 12px; margin: 0;">
        Syst√®me de suivi des t√¢ches
    </p>
</div>

<div style="border-top: 1px solid #d1d5db; padding-top: 16px;">
    <p style="color: #6b7280; font-size: 12px; margin: 0;">
        Cette notification est envoy√©e automatiquement pour vous tenir inform√©(e) des √©ch√©ances.<br>
        Pour toute question, contactez votre administrateur.
    </p>
</div>
{% endblock %}
